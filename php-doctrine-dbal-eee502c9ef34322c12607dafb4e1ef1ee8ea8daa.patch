From eee502c9ef34322c12607dafb4e1ef1ee8ea8daa Mon Sep 17 00:00:00 2001
From: Bart Visscher <bartv@thisnet.nl>
Date: Fri, 21 Jun 2013 12:11:22 +0200
Subject: [PATCH] Don't add 'NOT NULL' to the 'ALTER TABLE' when that hasn't
 changed

---
 lib/Doctrine/DBAL/Platforms/OraclePlatform.php     |  8 +++++++-
 .../Tests/DBAL/Platforms/OraclePlatformTest.php    | 22 ++++++++++++++++++++++
 2 files changed, 29 insertions(+), 1 deletion(-)

diff --git a/lib/Doctrine/DBAL/Platforms/OraclePlatform.php b/lib/Doctrine/DBAL/Platforms/OraclePlatform.php
index 5fc956f..6dbfbf1 100644
--- a/lib/Doctrine/DBAL/Platforms/OraclePlatform.php
+++ b/lib/Doctrine/DBAL/Platforms/OraclePlatform.php
@@ -629,7 +629,13 @@ public function getAlterTableSQL(TableDiff $diff)
              * Do not add query part if only comment has changed
              */
             if ( ! ($columnHasChangedComment && count($columnDiff->changedProperties) === 1)) {
-                $fields[] = $column->getQuotedName($this). ' ' . $this->getColumnDeclarationSQL('', $column->toArray());
+                $columnInfo = $column->toArray();
+
+                if ( ! $columnDiff->hasChanged('notnull')) {
+                    $columnInfo['notnull'] = false;
+                }
+
+                $fields[] = $column->getQuotedName($this) . ' ' . $this->getColumnDeclarationSQL('', $columnInfo);
             }
 
             if ($columnHasChangedComment) {
-- 
1.8.5.1

